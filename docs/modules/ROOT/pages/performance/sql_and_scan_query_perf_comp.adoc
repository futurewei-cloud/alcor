= SQL Fields Query and Scan Query Performance Comparision
Prasad Kommoju <pkommoju@futurewei.com>
2021-11-30
:toc: right
:imagesdir: ../../images


== Introduction
In Alcor there are some cases where queries are made on the cases using a field other than the key. Since Ignite is the KV database, these types of queries will require full scan (linear search) of the cache in question and this introduces big latencies as the number of entries in the cache grows.

Ignite supports secondary keys, called QuerySqlFields which will use a tradional B+Tree indexes which can answer point lookup and also range, minumum, maximum, greater than, and less than queries mush faster.

This report is about comparing the performance of the queries on non-key fields using Ignite's SCAN query and through SQL queries.

== Test setup
All times are in micro seconds. Time axis (y) in the histogram is in logscale.

Operations are on NodeInfo object. Benchmark tool, DPM, NCM and NMM run on the same physical machine in the lab. Ignite is run on two different physical machines in the lab (partitioned).

Number of entries in both SQL and Scan are 1M.

1000 queries are run but the performance statistics are only for 999
queries, ignoring the first one which always takes orders of
magnitude longer.

SQL_QUERY_EXEC time represents time required to execute the SQLFieldsQuery
(cache.query() API).

SQL_CURSOR_FETCH time represents time required to extract the result from
result set (cursor, cursor.get() API).

SCAN_QUERY_EXEC time represents time required to execute (QueryCursor
instantiation, cache.withKeepBinary().query(...)

SCAN_CURSOR_FETCH time represents time required to extract the result from
result set (cursor, cursor.getAll() API).

Total time is applicable only to insert operations therefore query execution
and fetch times show "N/A" for these operations.

For Insert operation, only total time for million insertions and average for
signle insert is relevant therefore other times are set to "N/A" (Not
Applicable).

== Results
|===
|OPERATION_TYPE|MIN         |MAX         |AVG         |TOTAL           |MEDIAN      |MODE        |P99
|SQL_EXEC      |      1.0000|     16.0000|      1.8739|N/A             |      1.0000|      1.0000|      7.0000
|SCAN_EXEC     |530,182.0000|785,735.0000|561,550.0000|N/A             |552,705.0000|543,704.0000|667,240.0000
|SQL_FECTH     |      0.0000|      3.0000|      0.7537|N/A             |      1.0000|      1.0000|      1.0000
|SCAN_FETCH    |      0.0000|      8.0000|      0.1411|N/A             |      0.0000|      0.0000|      3.0000
|SQL_INSERT    |      0.0000|N/A         |    929.6800|929,676,278.0000|N/A         |N/A         |N/A
|SCAN_INSERT   |      0.0000|N/A         |    812.4500|812,451,365.0000|N/A         |N/A         |N/A
|===

== Plot of the results
image::sql_and_scan_query_perf_comp.png[]
